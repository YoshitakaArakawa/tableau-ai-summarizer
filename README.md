# Pulse-like Insight Summarizer (Viz Extension)

This Tableau Viz Extension bootstraps an OpenAI-powered summarizer that mirrors Tableau Pulse-style insights. It reads Summary Data from the hosting worksheet, merges the data and user-provided context into a structured prompt, and submits it to an OpenAI Responses API endpoint via a lightweight local proxy.

## Folder Structure

- `manifest.json` - Viz Extension manifest placeholder (update author metadata before packaging).
- `public/`
  - `index.html` - Extension surface hosting configuration controls and output area.
  - `styles.css` - Lightweight styling for the control panel.
  - `config/base_prompt.xml` - Runtime copy of the base prompt used to hydrate OpenAI requests.
  - `dist/` - TypeScript emit target (generated by `npm run build`).
- `src/`
  - `app.ts` - Main controller orchestrating Tableau data fetch, prompt building, and result rendering.
  - `index.ts` - Entry module referenced from `index.html`.
  - `api/openaiClient.ts` - Wrapper that posts prompt payloads to the proxy endpoint.
  - `prompt/payloadBuilder.ts` - Replaces tokens in the XML prompt template with live data and control settings.
  - `tables/summaryParser.ts` - Fetches Summary Data (with graceful fallbacks when run outside Tableau).
  - `ui/controls.ts` - Binds DOM controls, exposing consistent control-value access and loading states.
- `server/proxy.cjs` - Express-based proxy that forwards requests to OpenAI using `OPENAI_API_KEY` from `.env` and also serves the static assets under `public/`.

## Prerequisites

- Node.js 18+
- `.env` file with `OPENAI_API_KEY=sk-...` (optionally `PULSE_VIZ_PROXY_PORT`)

## Local Test Flow

```sh
npm install            # one-time dependency install
npm run build          # transpile TypeScript to public/dist/index.js
npm run proxy          # serve http://localhost:8787 and expose /api/generate
```

Then open `http://localhost:8787/` in a browser to exercise the Viz Extension UI. Tableau can also point to that URL when adding the extension to a dashboard. The client posts to `/api/generate`; without an API key the proxy returns HTTP 503 so you can still validate UI wiring.

To use a remote endpoint or different port, start the proxy with `PULSE_VIZ_PROXY_PORT=9000 npm run proxy` or inject `window.PULSE_VIZ_ENDPOINT` before `src/index.ts` loads.

## Next Steps

- Flesh out Tableau-specific data adapters (dimension-level summary, comparison windows) beyond current placeholders.
- Style and render the insight JSON as user-friendly narrative cards once the proxy returns real data.
- Harden the proxy (logging, auth, rate limiting) and deploy it behind HTTPS for production use.
- Replace the manifest placeholder with the final Viz Extension manifest produced by Tableau tooling.
